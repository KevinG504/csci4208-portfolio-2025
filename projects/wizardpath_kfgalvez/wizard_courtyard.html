<html>
    <head>
        <title>Triple Adventure</title>
        <link rel="icon" href="assets/weapons/cimitar.png" />
        <link rel="stylesheet" href="styles/styles.css"> 
        <link rel="stylesheet" href="wizard-styles/wizard-styles.css"> 
    </head>
    <body>
        <!-- style wrapper for buttons / gif-->
    <div id="wizardWrapper">
        <img id="wizardBackground" src='assets/wizard_corrupted-ogre.gif'> 

        <div id="wizardOverlay"> 
            <div id="ogreText"> 
                <h1>Courtyard</h1>
                <h2>A large, corrupted ogre stands at the center.</h2>
                <p>"No ordinary weapons will cut through that.."</p>
                <p>You suddenly remember the power within you. You look at your hands, sparking with pure energy.</p>
                <h4>What will you do?</h4>
                </div>
            <div id="battleText"></div>

            <!-- create buttons-->
            <div id="wizardbuttons"> 
                <button id='Electric blast' onclick='attack()' class="fight-button">Electric Blast</button>
                <a id='wizardPath' href='wizard_wizardPath.html' class="fight-button">
                    <button>Retreat</button>
                </a>
            </div>
        <!-- begin fight sequence with ogre-->
    </div>
        <!-- Display the three doors after defeating the ogre -->
    <div id="doorButtons" style="display:none;">
        <button onclick="location.href='wizard_cursedDoor.html?' + queryString">Cursed</button>
        <button onclick="openDoor()">Boss</button>
        <button onclick="location.href='wizard_puzzle-door.html?' + queryString">Puzzle</button>
    </div>

    <iframe src='wizard_inventory.html' id=inventory height=100 width=125></iframe>
    </div>
        <script>
            // update inventoriey and all items 
            inventory.src += location.search;
            wizardPath.href += location.search;
            var queryString = new URLSearchParams(location.search);
            var gp = +queryString.get("gp");
            var hp = +queryString.get("hp");
            var ap = +queryString.get("ap");
            var keys = +queryString.get("keys") || 0;
            //track if ogre is dead to prevent respawn
            var ogreDead = queryString.get('ogreDead') == 'true';
            var ogreHP = 10, ogreAP = 2;
            var battleText = document.getElementById('battleText');
            //if ogre dead, always display doors
            if (ogreDead){
                wizardBackground.src = "assets/wizard_finaldoors.png";
                wizardbuttons.style.display = "none"; //hide fight options
                document.getElementById('doorButtons').style.display = "block";
                ogreText.style.display = "none";
                battleText.style.display = "block";
                battleText.innerHTML = "You defeated the ogre and come upon 3 doors..";
            }
            //create battle system for ogre
            function attack(){
                //damage ogre takes
                ogreHP -= ap;
                if (ogreHP <= 0){
                    //if ogre is dead
                    wizardBackground.src = "assets/wizard_finaldoors.png";
                    queryString.set('gp',gp+3);
                    queryString.set('hp',hp);
                    queryString.set('ogreDead', 'true'); //prevents ogre from respawning
                    inventory.src ='wizard_inventory.html?'+queryString;
                    wizardbuttons.style.display = "none"; //hide ui once ogre is dead
                    document.getElementById('doorButtons').style.display = "block";
                    ogreText.style.display = "none";
                    battleText.style.display = "block";
                    battleText.innerHTML = "You defeated the ogre and come upon 3 doors..";
                }
                else {
                    //if ogre kills player
                    hp -= ogreAP
                    queryString.set('hp',hp);
                    inventory.src ='wizard_inventory.html?'+queryString;
                    battleText.innerHTML =`You hit for ${ap} damage, it has ${ogreHP}hp left.<br> You take ${ogreAP} damage.`
                    if (hp <= 0){
                        wizardbuttons.style.display = "none";
                        ogreText.style.display = "none";
                        battleText.style.display = "block";
                        battleText.innerHTML =`You Died.`
                        const returnBtn = document.createElement('button');
                        returnBtn.textContent = "Return to Menu";
                        returnBtn.onclick = () => window.location.href = '../index.html';
                        battleText.appendChild(document.createElement('br'));
                        battleText.appendChild(returnBtn);
                    }
                }
            }
            //open the door to boss room
            function openDoor(){
                //display message that key has been reduced.
                //now we can enter alchemy lab
                if (keys > 0){
                    battleText.innerHTML =`The door unlocked. but the key broke apart.`
                    keys--;
                    queryString.set('keys', keys);
                    inventory.src ='wizard_inventory.html?'+queryString;
                    window.location.href ='wizard_boss.html?'+queryString;
                }
                else {
                    battleText.innerHTML =`The door is locked`;
                }
            }
        </script>
    </body>
<html>